# Graph 工作流开发向导 🐾

欢迎新来的小猫咪！你即将探索的是一个强大而优雅的声明式图工作流系统。它的核心是**组件化**、**清晰的流程**和**高度的灵活性**。

本向导将帮助你快速理解项目结构，并顺利开启你的第一个功能开发之旅。

## 🗺️ 地图使用指南：如何阅读这些文档

为了让你最高效地学习，我们推荐以下阅读顺序：

1.  **`README.md` (当前文件)**
    *   **这是你的起点和向导**。它会告诉你该先看什么，后看什么，以及如何开始你的第一个开发任务。

2.  **`graph/docs/graph_components_manual.md`**
    *   **【第一站：组件百科】**。把它想象成你的魔法工具箱。在动手建造之前，先来这里看看我们有哪些现成的“积木”（原子组件和处理器），这能帮你避免重复造轮子。

3.  **`graph/docs/graph_development_manual.md`**
    *   **【第二站：建造蓝图】**。这本手册会教你如何使用工具箱里的工具。它是一份详细的建造指南，包含了架构思想、代码示例和最佳实践。

4.  **`graph/docs/llm_connection.md`**
    *   **【第三站：LLM 连接规范】**(选读)。本文档详细说明了我们与大语言模型（LLM）的通信标准，包括 Prompt 规范和错误处理。在编写任何调用 LLM 的代码前，请务必阅读。

## 🌟 黄金开发路径：从零到一的冒险

当你需要开发一个新功能时，可以遵循以下“黄金路径”，它会引导你顺利完成任务。

### 第 1 步: 构思你的蓝图
首先，想清楚你的功能需要一个怎样的流程。
- 它是一个简单的**线性流程**（一步接一步，像一条流水线）？
- 还是一个复杂的**图流程**（包含判断、分支和循环，像一张探险地图）？

### 第 2 步: 寻找现成的零件
打开你的“组件百科”(`graph_components_manual.md`)，仔细查看 `graph/processors/` 目录下是否已经有可以满足你需求的**原子组件**。
> **记住：** `graph/processors/` 目录是存放**具体业务逻辑**的地方。优先复用是高效开发的秘诀！

### 第 3 步: 创造新的核心逻辑 (如果需要)
如果现有的零件无法满足你，那么就得自己动手创造了。
- 在 `graph/processors/` 目录下的相关文件中，创建一个新的 `ProcessingComponent` 子类。
- 在这个类里，实现你的核心业务逻辑。

### 第 4 步: 编排你的工作流
现在，是时候把零件组装起来了！这部分工作主要在 `graph/workflow/` 目录下进行。
> **记住：** `graph/workflow/` 目录是存放**流程编排逻辑**的地方。它不关心业务细节，只负责指挥组件按顺序工作。在这一步请阅读建造蓝图**`graph/docs/graph_development_manual.md`**按规范开发。

1.  **创建处理器**: 在 `graph/workflow/components.py` 中创建一个新的 `BaseGraphProcessor` 或 `BaseProcessor` 子类。这是你整个工作流的“总指挥室”。
2.  **创建节点包装器**: 在 `graph/workflow/node_functions.py` 中，为你需要用到的每个组件创建一个 `...node` 包装器函数。它就像是给每个零件安上了一个标准接口。
    > **💡 重要提示：** 在节点函数中，你会看到一个 `emitter` 对象。**请善用它！** 它的作用是向外界（例如，前端的 **SSE 接口**）实时广播节点的执行状态。通过调用 `emitter.emit_node_started`, `emitter.emit_message`, `emitter.emit_error` 等方法，可以让你的工作流变得透明、可观测，这是实现流式响应的关键。
3.  **定义图结构**: 回到你的处理器类中，在 `setup_graph` 方法里，通过 `self.nodes` 和 `self.graph` 两个字典，清晰地声明你的工作流蓝图。

### 第 5 步，入口调用
在`graph/base_processor.py`中，添加新的graph.workflow.components组件名以及task_type来调用新的工作流吧🐾

### 第 6 步: 测试！
别忘了为你的新成果编写单元测试！一个经过测试的功能才是可靠的功能。为你的新组件、新节点、新路由都加上测试，确保它们能像预期的那样工作。

## 🚀 快速传送门：关键文件索引

以下是开发过程中最常接触的几个关键地点：

-   `graph/processors/`
    *   存放所有原子化的**业务逻辑组件**。
-   `graph/workflow/components.py`
    *   存放所有**工作流处理器** (图的定义)。
-   `graph/workflow/node_functions.py`
    *   存放节点的**包装器函数**。
-   `graph/workflow/router.py`
    *   存放可复用的**路由决策函数**。
-   `graph/event_emitter.py`
    *   存放事件发射器 `EventEmitter` 的定义，它是实现 SSE 流式通信的核心。

---

### 最后的最后：造福后猫！
你的工作流建造过程中创建的轮子和工具，不要忘记更新添加到`graph/docs/graph_development_manual.md`中~

祝你编码愉快，喵~ 
